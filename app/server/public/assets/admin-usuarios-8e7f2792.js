import{b as d,h as v,l as b,c as g,g as f}from"./init-35cba5cd.js";import{l as h,_ as x}from"./viewpartials-7a86f681.js";import{s}from"./toast-8abe4fe9.js";async function y(t){try{const e={method:"GET",headers:new Headers,redirect:"follow"};return await(await fetch(d+"/api/listarProgramasIESTP?iestpid="+t,e)).json()}catch(a){console.log("error",a)}}async function w(t){try{const e={method:"GET",headers:new Headers,redirect:"follow"};return await(await fetch(d+"/api/usuario_dni?dni="+t,e)).json()}catch(a){console.log("error",a)}}async function m(t){t.programaid==0&&(t.programaid=null);const a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)};try{return await(await fetch(d+"/api/usuario_save",a)).json()}catch(e){console.error("Error:",e)}}async function S(t){const a={method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)};try{return await(await fetch(d+"/api/usuario",a)).json()}catch(e){console.error("Error:",e)}}async function _(t){console.log(t);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({listausuarios:t})};try{return await(await fetch(d+"/api/importarUsuarios",a)).json()}catch(e){console.error("Error:",e)}}v();(async function(){let t=[{path:"partials/shared/header.html",container:"app-header"},{path:"partials/shared/menuadmin.html",container:"app-side"}];try{await h(t),x(()=>import("./common-8d3221b9.js"),[]),console.log("Las vistas parciales se han cargado correctamente!"),E()}catch(a){console.error(a)}})();function E(){T(),L(),O(),b(),D(),P(),I()}async function T(){(await g()).usuario.rolid!=1&&(location.href="sinacceso.html")}async function L(){let t=f("session").usuario;$("#txt_iestpid_upload").text(t.iestpid);let a=await y(t.iestpid);$("#drpprogramas").empty(),$("#drpprogramascodigo").empty(),$("#drpprogramas").append('<option value="0">TODOS</option>');for(let e of a)$("#drpprogramas").append(`<option value="${e.id}">${e.denominacion}</option>`),$("#drpprogramascodigo").append(`<option value="${e.id}">${e.id} - ${e.denominacion}</option>`)}async function O(){$("#btn_buscar_usuario").on("click",async function(t){t.preventDefault(),$("#btn_buscar_usuario").prop("disabled",!0);let a=$("#txt-dni").val(),e=await w(a);e?(s(" Se encontro en DNI en el Sistema."),$("#txt-dni").val(e.dni),$("#txt-nombres").val(e.nombres),$("#txt-apellidos").val(e.apellidos),$("#txt-correo").val(e.correo),$("#txt-telefonos").val(e.telefonos),$("#txt-telefonos").val(e.telefonos),$("#drpprogramas").val(e.programaid),$("#drprol").val(e.rolid),$("#btnactualizar").prop("disabled",!1),$("#btneliminar").prop("disabled",!1),$("#btnguardar").prop("disabled",!0)):(s("DNI no se encuentra en el Sistema."),$("#txt-nombres").val(""),$("#txt-apellidos").val(""),$("#txt-correo").val(""),$("#txt-telefonos").val(""),$("#txt-telefonos").val(""),$("#drpprogramas").val(""),$("#drprol").val(""),$("#btnactualizar").prop("disabled",!0),$("#btneliminar").prop("disabled",!0),$("#btnguardar").prop("disabled",!1)),$("#btn_buscar_usuario").prop("disabled",!1)})}async function D(){let t=f("session").usuario;$("#btnguardar").on("click",async function(a){a.preventDefault(),$("#btnguardar").prop("disabled",!0).text("Registrando...");let e=$("#txt-dni").val(),r=$("#txt-dni").val(),o=$("#txt-nombres").val(),i=$("#txt-apellidos").val(),n=$("#txt-correo").val(),c=$("#txt-telefonos").val(),l=$("#drpprogramas option:selected").val(),p=$("#drprol option:selected").val(),u=t.iestpid;await m({dni:e,nombres:o,apellidos:i,correo:n,telefonos:c,programaid:l,rolid:p,clave:r,iestpid:u})?s("Se guardo los datos correctamente"):s("Ocurrio un error."),$("#btnguardar").prop("disabled",!1).text("Registrar")}),$("#btnactualizar").on("click",async function(a){a.preventDefault(),$("#btnactualizar").prop("disabled",!0).text("Actualizando...");let e=$("#txt-dni").val();$("#txt-dni").val();let r=$("#txt-nombres").val(),o=$("#txt-apellidos").val(),i=$("#txt-correo").val(),n=$("#txt-telefonos").val(),c=$("#drpprogramas option:selected").val(),l=$("#drprol option:selected").val();t.iestpid,await m({dni:e,nombres:r,apellidos:o,correo:i,telefonos:n,programaid:c,rolid:l})?s("Se actualizo los datos correctamente"):s("Ocurrio un error."),$("#btnactualizar").prop("disabled",!1).text("Actualizar")}),$("#btneliminar").on("click",async function(a){a.preventDefault();var e=confirm("¿Estás seguro de que deseas eliminar?");if(e){$("#btneliminar").prop("disabled",!0).text("Eliminando...");let r=$("#txt-dni").val(),o=$("#txt-nombres").val(),i=$("#txt-apellidos").val(),n=$("#txt-correo").val(),c=$("#txt-telefonos").val(),l=$("#drpprogramas option:selected").val(),p=$("#drprol option:selected").val();await S({dni:r,nombres:o,apellidos:i,correo:n,telefonos:c,programaid:l,rolid:p})?s("Se actualizo los datos correctamente"):s("Ocurrio un error."),$("#btneliminar").prop("disabled",!1).text("Eliminar")}else console.log("El usuario canceló la acción.")})}async function P(){$("#btncambiarClave").on("click",async function(t){t.preventDefault(),$("#btncambiarClave").prop("disabled",!0).text("Guardando...");let a=$("#txt-dni").val(),e=$("#txt_clave_ant").val(),r=$("#txt_clave_nueva").val(),o=await changepassword({dni:a,clave_ant:e,clave_nueva:r});o.ischanged!=null?s(o.msj):(s("Se guardo los datos correctamente"),window.location.href="index.html"),$("#btncambiarClave").prop("disabled",!1).text("Guardar")})}function I(){$("#btnimportarusuarios").on("click",async function(t){await U()})}async function U(){$("#btnbuscarlibro").prop("disabled",!0).text("Importando...");var t=document.getElementById("inputGroupFile02").files[0];if(t){let a=await k(t);console.log(a);let e=await _(a);return j(e,"Reporte-importacion"),$("#btnbuscarlibro").prop("disabled",!1).text("Importar"),a}}function j(t,a){var e=alasql(`SELECT *
  FROM ? `,[t]),r=[{sheetid:"Reporte",headers:!0}];alasql(`SELECT INTO XLSX("${a}.xlsx",?) FROM ?`,[r,[e]])}function k(t){return new Promise((a,e)=>{console.log("Archivo seleccionado:",t.name);const r=new FileReader;r.onload=o=>{const i=new Uint8Array(o.target.result),n=XLSX.read(i,{type:"array"}),c=n.Sheets[n.SheetNames[0]],l=XLSX.utils.sheet_to_json(c);if(l.length==0){alert("Archivo Vacio","El archivo no tiene ningúna fila registrada.");return}return a(l)},r.onerror=o=>{e(o)},r.readAsArrayBuffer(t)})}
