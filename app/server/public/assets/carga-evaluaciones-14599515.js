import"./modulepreload-polyfill-3cfb730f.js";import{_ as v}from"./preload-helper-101896b7.js";import{l as b}from"./viewpartials-ac66bf27.js";import{b as d,g as f}from"./config-d2c69cb0.js";import{h as g,l as x}from"./init-b7ef0f37.js";import{s as n}from"./toast-8abe4fe9.js";async function h(t){try{const e={method:"GET",headers:new Headers,redirect:"follow"};return await(await fetch(d+"/api/listarProgramasIESTP?iestpid="+t,e)).json()}catch(a){console.log("error",a)}}async function y(t){try{const e={method:"GET",headers:new Headers,redirect:"follow"};return await(await fetch(d+"/api/usuario_dni?dni="+t,e)).json()}catch(a){console.log("error",a)}}async function m(t){t.programaid==0&&(t.programaid=null);const a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)};try{return await(await fetch(d+"/api/usuario_save",a)).json()}catch(e){console.error("Error:",e)}}async function w(t){const a={method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)};try{return await(await fetch(d+"/api/usuario",a)).json()}catch(e){console.error("Error:",e)}}async function S(t){console.log(t);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({listanotas:t})};try{return await(await fetch(d+"/api/importarNotas",a)).json()}catch(e){console.error("Error:",e)}}g();(async function(){let t=[{path:"partials/shared/header.html",container:"app-header"},{path:"partials/shared/menuadmin.html",container:"app-side"}];try{await b(t),v(()=>import("./common-8d3221b9.js"),[]),console.log("Las vistas parciales se han cargado correctamente!"),_()}catch(a){console.error(a)}})();function _(){E(),T(),x(),L(),O(),D()}async function E(){let t=f("session").usuario;$("#txt_iestpid_upload").text(t.iestpid);let a=await h(t.iestpid);$("#drpprogramas").empty(),$("#drpprogramascodigo").empty(),$("#drpprogramas").append('<option value="0">TODOS</option>');for(let e of a)$("#drpprogramas").append(`<option value="${e.id}">${e.denominacion}</option>`),$("#drpprogramascodigo").append(`<option value="${e.id}">${e.id} - ${e.denominacion}</option>`)}async function T(){$("#btn_buscar_usuario").on("click",async function(t){t.preventDefault(),$("#btn_buscar_usuario").prop("disabled",!0);let a=$("#txt-dni").val(),e=await y(a);e?(n(" Se encontro en DNI en el Sistema."),$("#txt-dni").val(e.dni),$("#txt-nombres").val(e.nombres),$("#txt-apellidos").val(e.apellidos),$("#txt-correo").val(e.correo),$("#txt-telefonos").val(e.telefonos),$("#txt-telefonos").val(e.telefonos),$("#drpprogramas").val(e.programaid),$("#drprol").val(e.rolid),$("#btnactualizar").prop("disabled",!1),$("#btneliminar").prop("disabled",!1),$("#btnguardar").prop("disabled",!0)):(n("DNI no se encuentra en el Sistema."),$("#txt-nombres").val(""),$("#txt-apellidos").val(""),$("#txt-correo").val(""),$("#txt-telefonos").val(""),$("#txt-telefonos").val(""),$("#drpprogramas").val(""),$("#drprol").val(""),$("#btnactualizar").prop("disabled",!0),$("#btneliminar").prop("disabled",!0),$("#btnguardar").prop("disabled",!1)),$("#btn_buscar_usuario").prop("disabled",!1)})}async function L(){let t=f("session").usuario;$("#btnguardar").on("click",async function(a){a.preventDefault(),$("#btnguardar").prop("disabled",!0).text("Registrando...");let e=$("#txt-dni").val(),r=$("#txt-dni").val(),o=$("#txt-nombres").val(),i=$("#txt-apellidos").val(),s=$("#txt-correo").val(),c=$("#txt-telefonos").val(),l=$("#drpprogramas option:selected").val(),p=$("#drprol option:selected").val(),u=t.iestpid;await m({dni:e,nombres:o,apellidos:i,correo:s,telefonos:c,programaid:l,rolid:p,clave:r,iestpid:u})?n("Se guardo los datos correctamente"):n("Ocurrio un error."),$("#btnguardar").prop("disabled",!1).text("Registrar")}),$("#btnactualizar").on("click",async function(a){a.preventDefault(),$("#btnactualizar").prop("disabled",!0).text("Actualizando...");let e=$("#txt-dni").val();$("#txt-dni").val();let r=$("#txt-nombres").val(),o=$("#txt-apellidos").val(),i=$("#txt-correo").val(),s=$("#txt-telefonos").val(),c=$("#drpprogramas option:selected").val(),l=$("#drprol option:selected").val();t.iestpid,await m({dni:e,nombres:r,apellidos:o,correo:i,telefonos:s,programaid:c,rolid:l})?n("Se actualizo los datos correctamente"):n("Ocurrio un error."),$("#btnactualizar").prop("disabled",!1).text("Actualizar")}),$("#btneliminar").on("click",async function(a){a.preventDefault();var e=confirm("¿Estás seguro de que deseas eliminar?");if(e){$("#btneliminar").prop("disabled",!0).text("Eliminando...");let r=$("#txt-dni").val(),o=$("#txt-nombres").val(),i=$("#txt-apellidos").val(),s=$("#txt-correo").val(),c=$("#txt-telefonos").val(),l=$("#drpprogramas option:selected").val(),p=$("#drprol option:selected").val();await w({dni:r,nombres:o,apellidos:i,correo:s,telefonos:c,programaid:l,rolid:p})?n("Se actualizo los datos correctamente"):n("Ocurrio un error."),$("#btneliminar").prop("disabled",!1).text("Eliminar")}else console.log("El usuario canceló la acción.")})}async function O(){$("#btncambiarClave").on("click",async function(t){t.preventDefault(),$("#btncambiarClave").prop("disabled",!0).text("Guardando...");let a=$("#txt-dni").val(),e=$("#txt_clave_ant").val(),r=$("#txt_clave_nueva").val(),o=await changepassword({dni:a,clave_ant:e,clave_nueva:r});o.ischanged!=null?n(o.msj):(n("Se guardo los datos correctamente"),window.location.href="index.html"),$("#btncambiarClave").prop("disabled",!1).text("Guardar")})}function D(){$("#btnimportarusuarios").on("click",async function(t){await P()})}async function P(){$("#btnbuscarlibro").prop("disabled",!0).text("Importando...");var t=document.getElementById("inputGroupFile02").files[0];if(t){let a=await j(t);console.log(a);let e=await S(a);return I(e,"Reporte-importacion"),$("#btnbuscarlibro").prop("disabled",!1).text("Importar"),a}}function I(t,a){var e=alasql(`SELECT *
  FROM ? `,[t]),r=[{sheetid:"Reporte",headers:!0}];alasql(`SELECT INTO XLSX("${a}.xlsx",?) FROM ?`,[r,[e]])}function j(t){return new Promise((a,e)=>{console.log("Archivo seleccionado:",t.name);const r=new FileReader;r.onload=o=>{const i=new Uint8Array(o.target.result),s=XLSX.read(i,{type:"array"}),c=s.Sheets[s.SheetNames[0]],l=XLSX.utils.sheet_to_json(c);if(l.length==0){alert("Archivo Vacio","El archivo no tiene ningúna fila registrada.");return}return a(l)},r.onerror=o=>{e(o)},r.readAsArrayBuffer(t)})}
