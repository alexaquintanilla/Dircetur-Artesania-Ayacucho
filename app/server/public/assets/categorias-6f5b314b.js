import"./modulepreload-polyfill-3cfb730f.js";import{_ as h}from"./preload-helper-101896b7.js";import{b as n,a as m}from"./config-d2c69cb0.js";import{F as E}from"./upload-fc196769.js";import{A as b}from"./alert-3bd678b2.js";import{s as I}from"./toast-8abe4fe9.js";import{l as w}from"./viewpartials-ac66bf27.js";import{h as B,l as C}from"./init-b7ef0f37.js";async function P(){try{return await(await fetch(n+"/categoria")).json()}catch(e){console.error("Error al encontrar las categorias:",e)}}async function T(e){try{const t=new URLSearchParams(e);return await(await fetch(n+`/categorias?${t}`)).json()}catch(t){console.error("Error al buscar las categorias:",t)}}async function L(e){try{const t={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})};return await(await fetch(n+"/categoria",t)).json()}catch(t){console.error("Error:",t)}}async function _(e,t){try{const a={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r=await fetch(`${n}/categoria/${e}`,a);if(!r.ok)throw new Error(`Error al actualizar la categoría: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error:",a),a}}async function D(e){try{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await(await fetch(n+"/categoria",t)).json()}catch(t){console.error("Error:",t)}}const U=new b;B();(async function(){let e=[{path:"partials/shared/header.html",container:"app-header"},{path:"partials/shared/menu.html",container:"app-side"}];try{await w(e),h(()=>import("./common-8d3221b9.js"),[]),console.log("Las vistas parciales se han cargado correctamente!"),j()}catch(t){console.error(t)}})();function j(){setTimeout(function(){C()},500)}let f="";async function p(){try{const e=await P();v(e)}catch(e){console.error("Error:",e)}}function v(e){const a=document.getElementById("tablaCategoria").getElementsByTagName("tbody")[0];a.innerHTML="",e.forEach(r=>{const o=document.createElement("tr");o.innerHTML=`
      <td><img src="${r.foto_referente}" alt="${r.denominacion}" width="100"></td>
      <td>${r.denominacion}</td>
      <td>${r.abreviatura}</td>
      <td>${r.descripcion}</td>
      <td>
        <button type="button" class="btn btn-info btn-editar-categoria btn-sm">
          <i class="icon icon-edit2"></i>
        </button>
        <button type="button" class="btn btn-primary btn-eliminar-categoria btn-sm">
          <i class="icon icon-bin"></i>
        </button>
      </td>
    `,o.querySelector(".btn-editar-categoria").addEventListener("click",()=>z(r)),o.querySelector(".btn-eliminar-categoria").addEventListener("click",()=>k(r.id)),a.appendChild(o)})}async function k(e){U.createAlertDialog("confirm","Confirmar","¿Estás seguro que quieres eliminar la categoria?","Cancelar","Continuar",async()=>{try{await L(e)?await p():console.error("Error al eliminar la categoria")}catch(t){console.error("Error:",t)}})}async function z(e){const t=document.getElementById("actualizar-categoria-form"),a=document.getElementById("modalCategoriaEditar"),r=document.getElementById("abreviatura-editar"),o=document.getElementById("denominacion-editar"),c=document.getElementById("descripcion-editar"),i=document.getElementById("myfile-editar");r.value=e.abreviatura,o.value=e.denominacion,c.value=e.descripcion,$("#CategoriaImagePreviewEdit").attr("src",e.foto_referente).show(),$(a).modal("show");const s=document.getElementById("guardarCambios"),l=s.cloneNode(!0);s.parentNode.replaceChild(l,s),l.addEventListener("click",async u=>{u.preventDefault();const d={abreviatura:r.value,denominacion:o.value,descripcion:c.value};if(i.files[0]?d.foto_referente=f:d.foto_referente=e.foto_referente,!t.checkValidity()){t.reportValidity();return}try{const g=await _(e.id,d);I("Categoría actualizada exitosamente"),await p(),$(a).modal("hide")}catch(g){console.error("Error al actualizar la categoría:",g)}})}async function N(){const e=document.getElementById("registrar-categoria"),t=document.getElementById("registrar-categoria-form"),a=document.getElementById("modalCategoria");e.addEventListener("click",async r=>{if(r.preventDefault(),!t.checkValidity()){t.reportValidity();return}try{const i=document.getElementById("abreviatura").value,s=document.getElementById("denominacion").value,l=document.getElementById("descripcion").value;var o=document.getElementById("principalImagePreview"),c=o.src;const d=await D({abreviatura:i,denominacion:s,descripcion:l,foto_referente:c});console.log(d),await p(),R(),$(a).modal("hide")}catch(i){console.error("Error:",i)}})}async function O(){document.getElementById("filtrar-categoria").addEventListener("click",async t=>{t.preventDefault();const a=document.getElementById("abreviatura-categoria").value,r=document.getElementById("denominacion-categoria").value,c=await T({abreviatura:a,denominacion:r});v(c)})}document.addEventListener("DOMContentLoaded",()=>{y({fileInputId:"myfile",progressBarId:"progressBar",statusElementId:"status",uploadUrl:n+"/categoria/fileupload",folder:"/categorias/",callback:S}),y({fileInputId:"myfile-editar",progressBarId:"progressBar-editar",statusElementId:"status-editar",uploadUrl:n+"/categoria/fileupload",folder:"/categorias/",callback:A}),p(),N(),O()});document.getElementById("myfile").addEventListener("change",function(){var e=this.files[0],t=e.type,a=["image/png","image/jpeg"];a.includes(t)||(alert("Solo se permiten archivos PNG o JPG"),this.value="")});document.getElementById("myfile-editar").addEventListener("change",function(){var e=this.files[0],t=e.type,a=["image/png","image/jpeg"];a.includes(t)||(alert("Solo se permiten archivos PNG o JPG"),this.value="")});function y({fileInputId:e,progressBarId:t,statusElementId:a,uploadUrl:r,folder:o,callback:c}){const i=document.getElementById(e),s=i.name,l=document.getElementById(t),u=document.getElementById(a);i&&l&&u?new E(r,l,u,c,s,o).attachToFileInput(i):console.error("Initialization failed: One or more elements not found.")}function S(e){let t=$("#myfile").prop("files")[0];if(t){let a=new FileReader;a.onload=function(r){$("#principalImagePreview").attr("src",m(n)+"/"+e.ruta).show(),$("#principalImageName").val(t.name)},a.readAsDataURL(t),f=m(n)+"/"+e.ruta}else alert("Por favor, seleccione un archivo para visualizar.")}function A(e){let t=$("#myfile-editar").prop("files")[0];if(t){let a=new FileReader;a.onload=function(r){$("#CategoriaImagePreviewEdit").attr("src",m(n)+"/"+e.ruta).show()},a.readAsDataURL(t),f=m(n)+"/"+e.ruta,alert("Actualización de la imagen correctamente")}else alert("Por favor, seleccione un archivo para visualizar.")}$("#modalCategoria").on("shown.bs.modal",function(){$("#abreviatura").val(""),$("#denominacion").val(""),$("#descripcion").val(""),$("#myfile").val(""),$("#status").html(""),$("#principalImagePreview").attr("src","").css("display","none")});function R(){$("#abreviatura").val(""),$("#denominacion").val(""),$("#descripcion").val(""),$("#myfile").val(""),$("#principalImagePreview").attr("src","").css("display","none"),$("#status").html("")}
