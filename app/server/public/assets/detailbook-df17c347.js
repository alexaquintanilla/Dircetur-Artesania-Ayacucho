import{b as u,h as P,l as _,c as E,g as l}from"./init-35cba5cd.js";import{l as R,_ as T}from"./viewpartials-7a86f681.js";import{o as k}from"./path-6610c907.js";import{s as n}from"./toast-8abe4fe9.js";async function I(e){try{const r={method:"GET",headers:new Headers,redirect:"follow"};return await(await fetch(u+"/api/libro?id="+e,r)).json()}catch(t){console.log("error",t)}}async function C(e,t){const r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({libroid:e,valor:t})};try{return await(await fetch(u+"/api/valorar-libro",r)).json()}catch(o){console.error("Error:",o)}}async function O(e,t,r=1){const o={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({libroid:e,usuarioid:t,ope:r})};try{return await(await fetch(u+"/api/guardar-libro",o)).json()}catch(a){console.error("Error:",a)}}async function p(e){debugger;console.log(e);const t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)};try{return await(await fetch(u+"/api/leer-libro",t)).json()}catch(r){console.error("Error:",r)}}P();(async function(){let e=[{path:"partials/shared/header.html",container:"app-header"},{path:"partials/shared/menu.html",container:"app-side"}];try{await R(e),T(()=>import("./common-8d3221b9.js"),[]),console.log("Las vistas parciales se han cargado correctamente!"),U()}catch(t){console.error(t)}})();function U(){A(),B(),j(),q(),F(),G(),_()}function j(){c("btn-ref-apa7","txt-ref-apa7"),c("btn-ref-ieee","txt-ref-ieee"),c("btn-ref-vancuver","txt-ref-vancuver"),c("btn-ref-iso","txt-ref-iso")}async function A(){let e=await E();console.log(e),e.isvalid?H(e):location.href="sinacceso.html"}function H(e){$("#mlbliestp").text(e.usuario.iestp.nombre),$("#m_programas").empty();let t=1;for(let r of e.usuario.programas)$("#m_programas").append(`
        <li>${t}.- ${r.denominacion}</li>
      `),t++}var i={};async function B(){let{id:e}=k(),t=await I(e);i=t,D(t)}var s=0,d="";function D({id:e,titulo:t,autores:r,editorial:o,nropaginas:a,anioedicion:m,tomo:f,ciudad:b,isbn:g,temas:h,url_portada:w,resenia:x,ref_apa7:y,ref_ieee:v,ref_vancuver:S,ref_iso:L}){s=e,d=t,$("#txt-titulo").text(t),$("#card-titulo").text(t),$("#txt-autores").text(r),$("#card-autores").text(r),$("#txt-editorial").text(o),$("#txt-nropaginas").text(a),$("#txt-anioedicion").text(m),$("#txt-tomo").text(f),$("#txt-ciudad").text(b),$("#txt-isbn").text(g),$("#txt-temas").text(h),$("#txt-resenia").text(x),$("#card-url_portada").attr("src",w),$("#txt-ref-apa7").text(y),$("#txt-ref-ieee").text(v),$("#txt-ref-vancuver").text(S),$("#txt-ref-iso").text(L)}function c(e,t){document.getElementById(e).addEventListener("click",function(){var r=document.getElementById(t),o=document.createRange();o.selectNode(r);var a=window.getSelection();a.removeAllRanges(),a.addRange(o),document.execCommand("copy"),a.removeAllRanges(),n("Referencia copiada.")})}async function q(){$(".rating").on("click",async function(){let e=$(this).val(),t=await C(s,e);console.log(t),t.id&&n("Puntuaci√≥n asignada correctamente.")})}async function F(){$("#btn-save-mislibros").on("click",async function(){let e=l("usuario"),t=await O(s,e.id);console.log(t),t.id&&n("Se guardo en mis libros correctamente.")})}async function G(){$("#btn-leerlibro").on("click",async function(){let e=l("session").usuario,t={dni:e.dni,usuarioid:e.id,usuario:e.nombres+" "+e.apellidos,libro:i.titulo,libroid:i.id,autor:i.autores,programa:e.programas[0].denominacion,programaid:e.programaid,iestp:e.iestp.nombre,iestpid:e.iestpid};(await p(t)).insertado&&(n("Se guardo  libros correctamente."),window.location.href=`leer-libro.html?libroid=${s}&titulo=${d}`)}),$("#card-url_portada").on("click",async function(){let e=l("session").usuario,t={dni:e.dni,usuarioid:e.id,usuario:e.nombres+" "+e.apellidos,libro:i.titulo,libroid:i.id,autor:i.autores,programa:e.programas[0].denominacion,programaid:e.programaid,iestp:e.iestp.nombre,iestpid:e.iestpid};(await p(t)).insertado&&(n("Se guardo  libros correctamente."),window.location.href=`leer-libro.html?libroid=${s}&titulo=${d}`)}),$("#card-titulo").on("click",async function(){let e=l("session").usuario,t={dni:e.dni,usuarioid:e.id,usuario:e.nombres+" "+e.apellidos,libro:i.titulo,libroid:i.id,autor:i.autores,programa:e.programas[0].denominacion,programaid:e.programaid,iestp:e.iestp.nombre,iestpid:e.iestpid};(await p(t)).insertado&&(n("Se guardo  libros correctamente."),window.location.href=`leer-libro.html?libroid=${s}&titulo=${d}`)})}
