import"./modulepreload-polyfill-3cfb730f.js";import{_ as M}from"./preload-helper-101896b7.js";import{b as w,g as A}from"./config-d2c69cb0.js";import{l as D}from"./viewpartials-ac66bf27.js";import{A as F}from"./alert-3bd678b2.js";import{h as S,l as U}from"./init-b7ef0f37.js";async function H(e,t,l){try{return await(await fetch(`${w}/ventapedido?page=${e}&limit=${t}&idartesano=${l}`)).json()}catch(a){throw console.error("Error al encontrar las categorías:",a),a}}async function N(e){try{const t=new URLSearchParams(e);return await(await fetch(`${w}/ventapedidos?${t}`)).json()}catch(t){throw console.error("Error al buscar las categorias:",t),t}}new F;S();(async function(){let e=[{path:"partials/shared/header.html",container:"app-header"},{path:"partials/shared/menu.html",container:"app-side"}];try{await D(e),M(()=>import("./common-8d3221b9.js"),[]),console.log("Las vistas parciales se han cargado correctamente!"),j()}catch(t){console.error(t)}})();function j(){setTimeout(function(){U()},500)}var y=0;let O=A("session").usuarios;y=O.datos[0].id;const m=10;let n=1,v=0,_={};const V=document.getElementById("filtrar-pedido"),z=document.getElementById("tablaPedidos"),I=z.getElementsByTagName("tbody")[0];async function B(){try{let e;if(Object.keys(_).length===0)e=await H(n,m,y);else{const t={..._,page:n,limit:m};e=await N(t)}T(e.pedidos),v=Math.ceil(e.totalItems/m),x(v,e.totalItems)}catch(e){console.error("Error:",e)}}function x(e,t){const l=(n-1)*m+1;let a=n*m;a>t&&(a=t);const g=document.getElementById("paginationInfo");g.innerHTML=`Viendo del ${l} al ${a} de un total de ${t} resultados`;const o=document.getElementById("paginationControls");o.innerHTML="";const r=document.createElement("li");r.className="paginate_button page-item previous",r.id="apiCallbacks_previous",n===1&&r.classList.add("disabled");const f=document.createElement("a");f.className="page-link",f.href="#",f.textContent="Anterior",f.addEventListener("click",()=>u(n-1)),r.appendChild(f),o.appendChild(r);const L=3;if(e<=L)for(let d=1;d<=e;d++){const c=document.createElement("li");c.className="paginate_button page-item",d===n&&c.classList.add("active");const p=document.createElement("a");p.className="page-link",p.href="#",p.textContent=d,p.addEventListener("click",()=>u(d)),c.appendChild(p),o.appendChild(c)}else{const d=document.createElement("li");d.className="paginate_button page-item",n===1&&d.classList.add("active");const c=document.createElement("a");if(c.className="page-link",c.href="#",c.textContent=1,c.addEventListener("click",()=>u(1)),d.appendChild(c),o.appendChild(d),n>Math.floor(L/2)+1){const i=document.createElement("li");i.className="paginate_button page-item disabled",i.id="apiCallbacks_ellipsis";const s=document.createElement("a");s.className="page-link",s.href="#",s.textContent="…",i.appendChild(s),o.appendChild(i)}let p=Math.max(n-Math.floor(L/2),2),$=Math.min(p+L-1,e-1);for(let i=p;i<=$;i++){const s=document.createElement("li");s.className="paginate_button page-item",i===n&&s.classList.add("active");const C=document.createElement("a");C.className="page-link",C.href="#",C.textContent=i,C.addEventListener("click",()=>u(i)),s.appendChild(C),o.appendChild(s)}if($<e-1){const i=document.createElement("li");i.className="paginate_button page-item disabled",i.id="apiCallbacks_ellipsis";const s=document.createElement("a");s.className="page-link",s.href="#",s.textContent="…",i.appendChild(s),o.appendChild(i)}const k=document.createElement("li");k.className="paginate_button page-item",n===e&&k.classList.add("active");const E=document.createElement("a");E.className="page-link",E.href="#",E.textContent=e,E.addEventListener("click",()=>u(e)),k.appendChild(E),o.appendChild(k)}const h=document.createElement("li");h.className="paginate_button page-item next",h.id="apiCallbacks_next",n===e&&h.classList.add("disabled");const b=document.createElement("a");b.className="page-link",b.href="#",b.textContent="Siguiente",b.addEventListener("click",()=>u(n+1)),h.appendChild(b),o.appendChild(h)}async function u(e){e!==n&&(n=e,await B())}async function R(){V.addEventListener("click",async e=>{e.preventDefault();const t=document.getElementById("num-pedido").value,l=document.getElementById("nombre-cliente").value,a=document.getElementById("fecha-pedido").value,g=document.getElementById("estado").value;_={num_pedido:t,nombre_cliente:l,fecha_pedido:a,estado:g,idartesano:y},n=1;try{const o={..._,page:n,limit:m},r=await N(o);T(r.pedidos),v=Math.ceil(r.totalItems/m),x(v,r.totalItems)}catch(o){console.error("Error al filtrar pedidos:",o)}})}function T(e){I.innerHTML="",e.forEach(t=>{const l=document.createElement("tr");let a="";switch(t.estado){case"pendiente":a="badge badge-pill badge-warning text-white";break;case"pagado":a="badge badge-pill badge-success";break;case"envio":a="badge badge-pill badge-info";break;case"finalizado":a="badge badge-pill badge-primary";break;case"anulado":a="badge badge-pill badge-danger";break;default:a=""}l.innerHTML=`
            <td>${t.num_pedido}</td>
            <td>${t.cliente.nombres} ${t.cliente.apellidos}</td> 
            <td>${P(t.fecha_pedido)}</td>
            <td>${P(t.updatedAt)}</td>
            <td><span class="${a}">${t.estado}</span></td>
            <td>
                <button type="button" class="btn btn-light btn-sm">
                    <a href="/ventaartesano-detalle.html?id=${t.num_pedido}">
                        <i class="icon icon-eye2"></i>
                    </a>
                </button>
            </td>
        `,I.appendChild(l)})}function P(e){const t=new Date(e),l=t.getUTCFullYear(),a=("0"+(t.getUTCMonth()+1)).slice(-2);return`${("0"+t.getUTCDate()).slice(-2)}/${a}/${l}`}document.addEventListener("DOMContentLoaded",()=>{B(),R()});
